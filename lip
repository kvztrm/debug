-- Life in Prison - Propane Tank Auto Dropper
-- Toggle with Q
-- No teleport, only faces the target direction
-- Skips equipping if slot 3 is already equipped

local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local enabled = false

-- Remote & args
local remote = ReplicatedStorage:WaitForChild("Events"):WaitForChild("RemoteEvent")
local tank = workspace:WaitForChild("pickups"):WaitForChild("Propane Tank")
local args = {12, tank}

local HOTKEY = Enum.KeyCode.Three
local TOGGLE_KEY = Enum.KeyCode.Q

-- The exact position where you want the tank to drop
local TARGET_DROP_POS = Vector3.new(-1315, 1005, -432)

local function isSlot3Equipped()
    local character = player.Character
    if not character then return false end
    
    local tool = character:FindFirstChildWhichIsA("Tool")
    if tool and tool.Parent == character then
        -- Check if whatever is equipped is in slot 3
        -- In most games slot 3 = the 3rd tool in Backpack when equipped
        -- But more reliably: just check if ANY tool is equipped
        -- (most prison games only let you equip one at a time)
        return true
    end
    
    return false
end

local function faceTarget()
    local character = player.Character
    local root = character and character:FindFirstChild("HumanoidRootPart")
    if not root then return end
    
    local currentPos = root.Position
    local direction = (TARGET_DROP_POS - currentPos).Unit
    
    -- Only rotate horizontally (keep current height/pitch)
    root.CFrame = CFrame.new(currentPos) * CFrame.lookAt(Vector3.new(), direction)
end

local function doDrop()
    if not enabled then return end
    
    local character = player.Character
    if not character then return end
    
    -- Face the target drop position
    faceTarget()
    
    -- Only press 3 if nothing is equipped right now
    if not isSlot3Equipped() then
        VirtualInputManager:SendKeyEvent(true, HOTKEY, false, game)
        task.wait(0.025)
        VirtualInputManager:SendKeyEvent(false, HOTKEY, false, game)
        task.wait(0.05)  -- small delay after equip
    end
    
    -- Fire the remote (drop / pickup / use)
    pcall(function()
        remote:FireServer(unpack(args))
    end)
end

local function toggle()
    enabled = not enabled
    
    if enabled then
        print("[Propane Dropper] ON → dropping towards -1315, 1005, -432")
    else
        print("[Propane Dropper] OFF")
    end
    
    if enabled then
        task.spawn(function()
            while enabled do
                pcall(doDrop)
                task.wait(0.18)  -- adjust this (0.12–0.35) depending on kick threshold
            end
        end)
    end
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == TOGGLE_KEY then
        toggle()
    end
end)

print("[Life in Prison] Propane Auto-Drop loaded")
print("Press Q to toggle | Drops face towards: -1315, 1005, -432")
