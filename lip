-- Aggressive Script Scanner
-- Looks for trident-related keywords in every script's source code

local keywords = {
    "trident",
    "tridentwave",
    "tridentwavehitbox",
    "trident wave",
    "trident_wave",
    -- add more variations if needed
}

-- Make search case-insensitive
local patterns = {}
for _, kw in ipairs(keywords) do
    patterns[kw] = kw:lower()
end

local function containsKeyword(source)
    if not source or type(source) ~= "string" or #source == 0 then
        return false
    end
    
    local lowerSource = source:lower()
    
    for _, pattern in pairs(patterns) do
        if lowerSource:find(pattern, 1, true) then
            return true, pattern
        end
    end
    
    return false
end

local function getScriptSource(scriptInstance)
    -- Try multiple methods to get source code
    local methods = {
        function() return scriptInstance.Source end,
        function() return getscriptsource and getscriptsource(scriptInstance) end,
        function() return decompile and decompile(scriptInstance) end,
    }
    
    for _, method in ipairs(methods) do
        local success, result = pcall(method)
        if success and type(result) == "string" and #result > 0 then
            return result
        end
    end
    
    return nil
end

local found = {}

local function scanObject(obj, depth)
    depth = depth or 0
    
    if depth > 25 then return end  -- prevent infinite recursion
    
    if obj:IsA("LuaSourceContainer") then  -- ModuleScript, Script, LocalScript
        
        local source = getScriptSource(obj)
        
        if source then
            local hasKeyword, matched = containsKeyword(source)
            
            if hasKeyword then
                table.insert(found, {
                    name = obj:GetFullName(),
                    class = obj.ClassName,
                    matched_keyword = matched,
                    source_length = #source,
                    -- source = source  -- uncomment only if you really need it (very heavy)
                })
                
                print(string.format(
                    "[FOUND] %s  (%s)  →  keyword: %s  (length: %d)",
                    obj:GetFullName(),
                    obj.ClassName,
                    matched,
                    #source
                ))
            end
        end
    end
    
    -- Recurse into children
    for _, child in ipairs(obj:GetChildren()) do
        scanObject(child, depth + 1)
    end
end

local function scanAll()
    print("Starting aggressive trident keyword scan...")
    print("Keywords being searched:", table.concat(keywords, ", "))
    print("----------------------------------------")
    
    found = {}
    
    -- Scan common places first (faster feedback)
    local commonPlaces = {
        game:GetService("ReplicatedStorage"),
        game:GetService("ServerScriptService"),
        game:GetService("StarterPlayer").StarterPlayerScripts,
        game:GetService("StarterGui"),
        game:GetService("StarterPack"),
        workspace,
        game:GetService("Lighting"),
        game:GetService("Players").LocalPlayer:FindFirstChild("PlayerScripts"),
    }
    
    for _, place in ipairs(commonPlaces) do
        if place then
            scanObject(place)
        end
    end
    
    -- Then scan literally everything else
    scanObject(game)
    
    print("\nScan completed.")
    print("Found " .. #found .. " scripts containing trident-related keywords.")
    
    if #found > 0 then
        print("\nSummary of matches:")
        for i, item in ipairs(found) do
            print(string.format("%2d. %-65s  (%s)  → %s",
                i,
                item.name,
                item.class,
                item.matched_keyword
            ))
        end
    end
end

-- Run the scan
scanAll()

-- Optional: re-scan when new scripts are added
game.DescendantAdded:Connect(function(desc)
    if desc:IsA("LuaSourceContainer") then
        task.spawn(function()
            local source = getScriptSource(desc)
            if source and containsKeyword(source) then
                warn("[NEW MATCH] " .. desc:GetFullName())
            end
        end)
    end
end)

print("Trident keyword scanner active (also watching for new scripts)")
