local GetService = setmetatable({}, {
	__index = function(Self, Name)
		Self[Name] = game:GetService(Name)
		return Self[Name]
	end
})

local Players = GetService.Players
local ReplicatedStorage = GetService.ReplicatedStorage
local RunService = GetService.RunService
local Workspace = GetService.Workspace
local Teams = GetService.Teams
local LocalPlayer = Players.LocalPlayer

-- FIXED: Safe RemoteEvent detection (tries multiple common paths)
local RemoteEvent = nil
local function FindRemoteEvent()
    local paths = {
        ReplicatedStorage:FindFirstChild("Events") and ReplicatedStorage.Events:FindFirstChild("RemoteEvent"),
        ReplicatedStorage:FindFirstChild("Remote"),
        ReplicatedStorage:FindFirstChild("RF") and ReplicatedStorage.RF:FindFirstChild("RemoteEvent"),
        ReplicatedStorage:FindFirstChild("Remotes") and ReplicatedStorage.Remotes:FindFirstChild("RemoteEvent"),
        ReplicatedStorage:FindFirstChild("Network") and ReplicatedStorage.Network:FindFirstChild("RemoteEvent")
    }
    
    for _, remote in paths do
        if remote and remote:IsA("RemoteEvent") then
            RemoteEvent = remote
            return true
        end
    end
    return false
end

FindRemoteEvent()
if not RemoteEvent then
    warn("âš ï¸ RemoteEvent not found! Script will still teleport but can't pickup/attack.")
end

local Pickups = Workspace:WaitForChild("pickups")
local TheTarget = nil

-- Helper to get very far random position (deep null-zone territory)
local function GetRandomFarPosition()
    local dist = math.random(900000, 3000000)
    local angle = math.random() * math.pi * 2
    local height = math.random(-500000, 500000)
    
    local x = math.cos(angle) * dist
    local z = math.sin(angle) * dist
    
    return Vector3.new(x, height, z)
end

RunService.Heartbeat:Connect(function()
    local MyChar = LocalPlayer.Character
    if not MyChar then return end
    
    local Humanoid = MyChar:FindFirstChildOfClass("Humanoid")
    local Root = MyChar:FindFirstChild("HumanoidRootPart")
    if not Humanoid or not Root then return end
    
    if Humanoid.Sit then Humanoid.Sit = false end
    if Root.Anchored then Root.Anchored = false end
    
    local Backpack = LocalPlayer:FindFirstChild("Backpack")
    local HasKnife = (MyChar:FindFirstChild("Knife")) or (Backpack and Backpack:FindFirstChild("Knife"))
    
    -- SAFE KNIFE PICKUP
    if not HasKnife then
        for _, Pickup in Pickups:GetChildren() do
            if Pickup.Name == "Knife" then
                local MeshPart = Pickup:FindFirstChild("Meshes/knife1")
                if MeshPart and MeshPart:IsA("BasePart") and MeshPart.Parent then
                    Root.CFrame = CFrame.new(MeshPart.Position)
                    task.wait(.2)
                    
                    -- SAFE FIRE SERVER
                    if RemoteEvent then
                        RemoteEvent:FireServer(12, Pickup)
                    end
                    task.wait(.2)
                    break
                end
            end
        end
        return
    end
    
    local Knife = MyChar:FindFirstChild("Knife") or (Backpack and Backpack:FindFirstChild("Knife"))
    if not Knife then return end
    
    -- TARGET LOGIC
    if TheTarget and TheTarget.Parent then
        local TargetChar = TheTarget.Character
        if TargetChar then
            local TargetRoot = TargetChar:FindFirstChild("HumanoidRootPart")
            local TargetHead = TargetChar:FindFirstChild("Head")
            local TargetHumanoid = TargetChar:FindFirstChildOfClass("Humanoid")
            local ForceField = TargetChar:FindFirstChildOfClass("ForceField")
            
            if TargetRoot and TargetHead and TargetHumanoid and TargetHumanoid.Health > 0 and not ForceField then
                local MyTeam = LocalPlayer.Team
                local TargetTeam = TheTarget.Team
                local IsPolice = MyTeam and MyTeam.Name == "Police"
                local TargetIsPolice = TargetTeam and TargetTeam.Name == "Police"
                
                Root.CFrame = TargetRoot.CFrame * CFrame.new(0, -6, 0)
                
                if IsPolice and TargetIsPolice then
                    if Knife.Parent == MyChar then
                        pcall(function() Humanoid:UnequipTools() end)
                    end
                    if (Root.Position - TargetRoot.Position).Magnitude <= 17 then
                        if RemoteEvent then
                            RemoteEvent:FireServer(33, TargetHead)
                        end
                    end
                else
                    if Knife.Parent == Backpack then
                        pcall(function() Humanoid:EquipTool(Knife) end)
                    end
                    if (Root.Position - TargetRoot.Position).Magnitude <= 37 then
                        local Direction = (TargetHead.Position - Root.Position).Unit
                        if RemoteEvent then
                            RemoteEvent:FireServer(16, Knife, TargetHead, Direction)
                        end
                    end
                end
                return
            end
        end
    end
    
    -- No valid target â†’ scan for new one + null-zone hopping
    TheTarget = nil
    
    -- Quick scan for new target
    for _, Player in Players:GetPlayers() do
        if Player ~= LocalPlayer then
            local TargetChar = Player.Character
            if TargetChar then
                local TargetHumanoid = TargetChar:FindFirstChildOfClass("Humanoid")
                local ForceField = TargetChar:FindFirstChildOfClass("ForceField")
                if TargetHumanoid and TargetHumanoid.Health > 0 and not ForceField then
                    TheTarget = Player
                    break
                end
            end
        end
    end
    
    -- Still no target â†’ RANDOM NULL-ZONE TELEPORT (anti-arrest)
    if not TheTarget then
        local randomPos = GetRandomFarPosition()
        Root.CFrame = CFrame.new(randomPos)
        
        -- Random delay between jumps (0.4-0.8s)
        task.wait(math.random(4, 8) / 10)
    end
end)

warn("âœ… FIXED: Null-zone hopping + nil-safe RemoteEvent detection")
warn("ðŸ’¡ Script auto-finds common RemoteEvent paths. Teleport works even if attack fails!")
