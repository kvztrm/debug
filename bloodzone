-- Clean up common inserted script
pcall(function()
    if workspace:FindFirstChild("Script") then
        workspace.Script:Destroy()
        print("Deleted workspace.Script")
    end
end)

local Players           = game:GetService("Players")
local RunService        = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInput      = game:GetService("VirtualInputManager")  -- must be supported by executor

local lp        = Players.LocalPlayer
local character = lp.Character or lp.CharacterAdded:Wait()
local humanoid  = character:WaitForChild("Humanoid")

lp.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoid  = newChar:WaitForChild("Humanoid")
end)

local targetPattern = "relkonta"

local remote
pcall(function()
    remote = ReplicatedStorage:WaitForChild("Remotes", 8)
                       :WaitForChild("Requests", 8)
                       :WaitForChild("SetMenuState", 5)
end)

if not remote then
    warn("SetMenuState remote not found — menu actions skipped")
end

local lastHealth = 100

print("Loop active | Target: *" .. targetPattern .. "* | Pressing KEY 1 after menu close")

while true do
    -- Find target (partial match on name or displayname)
    local targetChar = nil
    for _, p in ipairs(Players:GetPlayers()) do
        local n = p.Name:lower()
        local d = p.DisplayName:lower()
        if n:find(targetPattern, 1, true) or d:find(targetPattern, 1, true) then
            if p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                targetChar = p.Character
                break
            end
        end
    end

    -- Teleport 1–1.5 stud in front, facing them
    if targetChar and character and character:FindFirstChild("HumanoidRootPart") then
        local myHRP   = character.HumanoidRootPart
        local targHRP = targetChar.HumanoidRootPart
        local forward = targHRP.CFrame.LookVector
        local pos     = targHRP.Position - forward * 1.4
        myHRP.CFrame  = CFrame.new(pos, targHRP.Position)
    end

    -- Health drop → menu open → close → wait → press 1
    local currHealth = humanoid and humanoid.Health or 100

    if currHealth < 100 and lastHealth >= 100 then
        if remote then
            pcall(function() remote:InvokeServer(true)  end)
            task.wait(0.2)
            pcall(function() remote:InvokeServer(false) end)

            task.wait(2)

            -- Simulate press KEY 1 (down + up)
            pcall(function()
                VirtualInput:SendKeyEvent(true,  Enum.KeyCode.One, false, game)
                task.wait(0.2)  -- tiny hold time
                VirtualInput:SendKeyEvent(false, Enum.KeyCode.One, false, game)
                print("Simulated press of KEY 1")
            end)
        else
            warn("Health dropped but remote missing")
        end
    end

    lastHealth = currHealth

    RunService.Heartbeat:Wait()
end
