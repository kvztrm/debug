-- Cleanup at start
pcall(function()
    local s = workspace:FindFirstChild("Script")
    if s then s:Destroy() end
end)

local Players           = game:GetService("Players")
local RunService        = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInput      = game:GetService("VirtualInputManager")

local lp = Players.LocalPlayer
local lastHealth = 100

-- Safe remote paths (adjust names if different)
local menuRemote
local respawnRemote   -- ← change this name if it's not called "Respawn" or "SpawnIn"

pcall(function()
    menuRemote    = ReplicatedStorage.Remotes.Requests.SetMenuState
    respawnRemote = ReplicatedStorage.Remotes.Requests.Respawn          -- example name — CHANGE THIS
    -- or try: ReplicatedStorage.Remotes.Requests.SpawnIn
    -- or:     ReplicatedStorage.Remotes.Requests.LoadCharacter
    -- or whatever the respawn remote is actually called
end)

if not menuRemote then
    warn("Menu remote not found")
end
if not respawnRemote then
    warn("Respawn remote not found — will only force die, no manual respawn")
end

-- Get fresh character + humanoid every loop
local function getCharHum()
    local char = lp.Character
    if not char then return nil, nil end
    local hum = char:FindFirstChildWhichIsA("Humanoid")
    return char, hum
end

while true do
    local ok = pcall(function()
        local char, hum = getCharHum()
        if not char or not hum then
            RunService.Heartbeat:Wait()
            return
        end

        -- Teleport to relkonta
        local targetChar = nil
        for _, p in Players:GetPlayers() do
            if p ~= lp and (p.Name:lower():find("relkonta") or p.DisplayName:lower():find("relkonta")) then
                local tc = p.Character
                if tc and tc:FindFirstChild("HumanoidRootPart") then
                    targetChar = tc
                    break
                end
            end
        end

        if targetChar then
            local myRoot = char:FindFirstChild("HumanoidRootPart")
            local tRoot  = targetChar.HumanoidRootPart
            if myRoot and tRoot then
                local forward = tRoot.CFrame.LookVector
                local pos = tRoot.Position - forward * 1.4
                myRoot.CFrame = CFrame.new(pos, tRoot.Position)

                pcall(function() myRoot:SetNetworkOwner(lp) end)
                pcall(function()
                    hum:ChangeState(Enum.HumanoidStateType.Jumping)
                    task.wait(0.025)
                    myRoot.AssemblyLinearVelocity = Vector3.new(0, 18, 0)
                end)
            end
        end

        -- Health monitoring & forced death + respawn sequence
        local curr = hum.Health
        if curr < 100 and lastHealth >= 100 then
            -- Force die immediately (bypasses cooldown issues on natural death)
            pcall(function()
                hum.Health = 0
            end)

            -- Wait a bit for death animation / replication
            task.wait(0.6)  -- adjust if needed (0.4–1.2 range usually works)

            -- Try to trigger respawn via remote (if it exists)
            if respawnRemote then
                pcall(function()
                    respawnRemote:InvokeServer()   -- most respawn remotes take no args
                    -- or: respawnRemote:InvokeServer(true) / "Respawn" / etc.
                end)
            end

            -- Optional: menu toggle + key 1 after respawn attempt
            task.wait(0.4)  -- give time for character to load

            if menuRemote then
                pcall(function() menuRemote:InvokeServer(true) end)
                task.wait(0.18)
                pcall(function() menuRemote:InvokeServer(false) end)
                task.wait(0.25)

                -- Double key press for reliability
                pcall(function()
                    VirtualInput:SendKeyEvent(true, Enum.KeyCode.One, false, game)
                    task.wait(0.04)
                    VirtualInput:SendKeyEvent(false, Enum.KeyCode.One, false, game)
                end)
                task.wait(0.07)
                pcall(function()
                    VirtualInput:SendKeyEvent(true, Enum.KeyCode.One, false, game)
                    task.wait(0.04)
                    VirtualInput:SendKeyEvent(false, Enum.KeyCode.One, false, game)
                end)
            end
        end

        lastHealth = curr
    end)

    if not ok then
        -- silent catch — loop never dies
    end

    RunService.Heartbeat:Wait()
end
