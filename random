-- Team-based Aimbot with auto-switch
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

local enabled = false
local target = nil

function getTeam()
    local char = LocalPlayer.Character
    if char then
        local team = char:FindFirstChild("Team")
        if team then return team.Value end
    end
    return nil
end

function isEnemy(player)
    local myTeam = getTeam()
    if not myTeam then return true end -- No team means everyone is enemy
    
    local enemyTeam = player.Character and player.Character:FindFirstChild("Team")
    if enemyTeam then
        return enemyTeam.Value ~= myTeam
    end
    return true
end

function findClosestEnemy()
    local closest, dist = nil, 5000
    local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if myRoot then
        for _, p in ipairs(Players:GetPlayers()) do
            if p ~= LocalPlayer and isEnemy(p) and p.Character then
                local root = p.Character:FindFirstChild("HumanoidRootPart")
                local head = p.Character:FindFirstChild("Head")
                if root and head then
                    local d = (root.Position - myRoot.Position).Magnitude
                    if d < dist then
                        dist = d
                        closest = p
                    end
                end
            end
        end
    end
    return closest
end

function aimAtPlayer(player)
    if not player or not player.Character then return end
    local part = player.Character:FindFirstChild("Head") or player.Character:FindFirstChild("HumanoidRootPart")
    if part then
        Camera.CFrame = CFrame.new(Camera.CFrame.Position, part.Position)
        Mouse.Hit = CFrame.new(part.Position)
    end
end

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Q and input.UserInputType == Enum.UserInputType.Keyboard then
        enabled = not enabled
        
        if enabled then
            target = findClosestEnemy()
            if target then
                for i = 1, 10 do
                    aimAtPlayer(target)
                    game.RunService.Heartbeat:Wait()
                end
            else
                enabled = false
            end
        else
            target = nil
        end
    end
end)

RunService.RenderStepped:Connect(function()
    if enabled then
        -- Check if target is dead
        if target and target.Character then
            local humanoid = target.Character:FindFirstChild("Humanoid")
            if humanoid and humanoid.Health <= 0 then
                target = findClosestEnemy()
            end
        else
            target = findClosestEnemy()
        end
        
        -- Continue aiming
        if target then
            aimAtPlayer(target)
        end
    end
end)
