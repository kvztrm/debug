-- Aimbot - Lock to player closest to camera look direction
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

local enabled = false
local target = nil

function findClosestToCamera()
    local closest, closestAngle = nil, 360
    local camPos = Camera.CFrame.Position
    local camLook = Camera.CFrame.LookVector
    
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character then
            local root = p.Character:FindFirstChild("HumanoidRootPart")
            local head = p.Character:FindFirstChild("Head")
            if root and head then
                local partPos = head.Position
                local toPlayer = (partPos - camPos).Unit
                
                -- Calculate angle between camera look and player direction
                local angle = math.deg(math.acos(camLook:Dot(toPlayer)))
                
                if angle < closestAngle then
                    closestAngle = angle
                    closest = p
                end
            end
        end
    end
    
    return closest
end

function aimAtPlayer(player)
    if not player or not player.Character then return end
    local part = player.Character:FindFirstChild("Head") or player.Character:FindFirstChild("HumanoidRootPart")
    if part then
        Camera.CFrame = CFrame.new(Camera.CFrame.Position, part.Position)
        Mouse.Hit = CFrame.new(part.Position)
    end
end

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Q and input.UserInputType == Enum.UserInputType.Keyboard then
        enabled = not enabled
        
        if enabled then
            target = findClosestToCamera()
            if target then
                for i = 1, 10 do
                    aimAtPlayer(target)
                    task.wait(0.001)
                end
            else
                enabled = false
            end
        else
            target = nil
        end
    end
end)

RunService.RenderStepped:Connect(function()
    if enabled then
        target = findClosestToCamera()
        if target then
            aimAtPlayer(target)
        end
    end
end)
