-- External-style Aimbot with Target GUI
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- Settings
local settings = {
    enabled = false,
    fov = 100,
    aimKey = Enum.KeyCode.Q,
    aimPart = "Head"
}

local currentTarget = nil

-- Create Target GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AimbotGUI"
screenGui.IgnoreGuiInset = true
screenGui.Parent = game.CoreGui

local targetFrame = Instance.new("Frame")
targetFrame.Size = UDim2.new(0, 200, 0, 60)
targetFrame.Position = UDim2.new(0.5, -100, 0, 20)
targetFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
targetFrame.BorderColor3 = Color3.fromRGB(0, 150, 255)
targetFrame.BorderSizePixel = 2
targetFrame.Parent = screenGui
targetFrame.Visible = false

local avatarImage = Instance.new("ImageLabel")
avatarImage.Size = UDim2.new(0, 50, 0, 50)
avatarImage.Position = UDim2.new(0, 5, 0.5, -25)
avatarImage.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
avatarImage.BorderSizePixel = 0
avatarImage.Parent = targetFrame

local targetName = Instance.new("TextLabel")
targetName.Size = UDim2.new(0, 140, 0, 25)
targetName.Position = UDim2.new(0, 60, 0.5, -25)
targetName.BackgroundTransparency = 1
targetName.TextColor3 = Color3.fromRGB(255, 255, 255)
targetName.Font = Enum.Font.GothamBold
targetName.TextSize = 18
targetName.TextXAlignment = Enum.TextXAlignment.Left
targetName.Parent = targetFrame

local targetStatus = Instance.new("TextLabel")
targetStatus.Size = UDim2.new(0, 140, 0, 20)
targetStatus.Position = UDim2.new(0, 60, 0.5, 5)
targetStatus.BackgroundTransparency = 1
targetStatus.TextColor3 = Color3.fromRGB(0, 200, 100)
targetStatus.Font = Enum.Font.Gotham
targetStatus.TextSize = 14
targetStatus.TextXAlignment = Enum.TextXAlignment.Left
targetStatus.Text = "LOCKED"
targetStatus.Parent = targetFrame

function updateTargetGUI(player)
    if player then
        targetFrame.Visible = true
        targetName.Text = player.Name
        avatarImage.Image = game.Players:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
    else
        targetFrame.Visible = false
    end
end

-- FOV Circle
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 2
fovCircle.NumSides = 64
fovCircle.Filled = false
fovCircle.Color = Color3.fromRGB(0, 255, 0)

function getScreenSize()
    return workspace.CurrentCamera.ViewportSize
end

function worldToScreen(worldPoint)
    local screenPos, onScreen = Camera:WorldToViewportPoint(worldPoint)
    return Vector2.new(screenPos.X, screenPos.Y), onScreen
end

function findTarget()
    local screenCenter = getScreenSize() / 2
    local closestPlayer = nil
    local closestDistance = settings.fov
    
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character then
            local part = p.Character:FindFirstChild(settings.aimPart) or p.Character:FindFirstChild("HumanoidRootPart")
            if part then
                local screenPos, onScreen = worldToScreen(part.Position)
                if onScreen then
                    local distToCenter = (screenPos - screenCenter).Magnitude
                    if distToCenter < closestDistance then
                        closestDistance = distToCenter
                        closestPlayer = p
                    end
                end
            end
        end
    end
    return closestPlayer
end

function instantAim(target)
    if not target or not target.Character then return end
    local part = target.Character:FindFirstChild(settings.aimPart) or target.Character:FindFirstChild("HumanoidRootPart")
    if not part then return end
    Camera.CFrame = CFrame.new(Camera.CFrame.Position, part.Position)
    Mouse.Hit = CFrame.new(part.Position)
end

-- Fast update loop
RunService.RenderStepped:Connect(function()
    local screenCenter = getScreenSize() / 2
    if settings.enabled then
        fovCircle.Position = screenCenter
        fovCircle.Radius = settings.fov
        fovCircle.Visible = true
        currentTarget = findTarget()
        if currentTarget then
            instantAim(currentTarget)
            updateTargetGUI(currentTarget)
        else
            updateTargetGUI(nil)
        end
    else
        fovCircle.Visible = false
        currentTarget = nil
        updateTargetGUI(nil)
    end
end)

-- Extra fast updates
RunService.Heartbeat:Connect(function()
    if settings.enabled and currentTarget then
        instantAim(currentTarget)
    end
end)

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == settings.aimKey and input.UserInputType == Enum.UserInputType.Keyboard then
        settings.enabled = not settings.enabled
        if not settings.enabled then
            currentTarget = nil
            updateTargetGUI(nil)
        end
    end
    
    if input.KeyCode == Enum.KeyCode.E and settings.enabled then
        settings.aimPart = settings.aimPart == "Head" and "HumanoidRootPart" or "Head"
    end
end)

game.StarterGui:SetCore("SendNotification", {
    Title = "Aimbot Loaded",
    Text = "Q: Toggle | E: Switch Part",
    Duration = 5
})
