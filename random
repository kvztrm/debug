--[[
    Instant Aimbot Script (Aggressive Version)
    - Press Q to toggle aimlock on/off
    - Instantly locks onto closest player's head
    - Uses multiple methods for instant lock
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ContextActionService = game:GetService("ContextActionService")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- Script State
local aimlockEnabled = false
local aimlockTarget = nil
local detectionRange = 100

-- Find closest player to local player
function findClosestPlayer()
    local closestPlayer = nil
    local closestDistance = detectionRange
    
    local character = LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return nil end
    
    local myRoot = character.HumanoidRootPart
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local rootPart = player.Character.HumanoidRootPart
            local distance = (rootPart.Position - myRoot.Position).Magnitude
            
            if distance < closestDistance then
                closestDistance = distance
                closestPlayer = player
            end
        end
    end
    
    return closestPlayer
end

-- Instant aim function - multiple methods
function instantAim()
    if not aimlockTarget or not aimlockTarget.Character then return end
    
    local targetHead = aimlockTarget.Character:FindFirstChild("Head")
    if not targetHead then
        targetHead = aimlockTarget.Character:FindFirstChild("HumanoidRootPart")
    end
    
    if not targetHead then return end
    
    -- Method 1: Direct CFrame set
    Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetHead.Position)
    
    -- Method 2: Update mouse hit to force aim direction
    Mouse.Hit = CFrame.new(targetHead.Position)
    
    -- Method 3: Unbind camera temporarily
    local oldSubject = Camera.CameraSubject
    Camera.CameraSubject = nil
    Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetHead.Position)
    task.wait(0.01)
    Camera.CameraSubject = oldSubject
end

-- Fast update loop
local heartbeatConnection
heartbeatConnection = RunService.Heartbeat:Connect(function()
    if aimlockEnabled and aimlockTarget then
        instantAim()
        instantAim() -- Double call for extra certainty
    end
end)

-- Toggle with Q
UserInputService.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == Enum.KeyCode.Q then
            aimlockEnabled = not aimlockEnabled
            
            if aimlockEnabled then
                aimlockTarget = findClosestPlayer()
                
                if aimlockTarget then
                    -- Multiple instant aims for guaranteed lock
                    for i = 1, 5 do
                        instantAim()
                        task.wait(0.001)
                    end
                    
                    game.StarterGui:SetCore("SendNotification", {
                        Title = "Aimbot Locked",
                        Text = "Target: " .. aimlockTarget.Name,
                        Duration = 2
                    })
                else
                    aimlockEnabled = false
                    game.StarterGui:SetCore("SendNotification", {
                        Title = "No Target",
                        Text = "No players in range",
                        Duration = 2
                    })
                end
            else
                aimlockTarget = nil
                game.StarterGui:SetCore("SendNotification", {
                    Title = "Aimbot Disabled",
                    Text = "Press Q to enable",
                    Duration = 2
                })
            end
        end
    end
end)

-- Initial notification
game.StarterGui:SetCore("SendNotification", {
    Title = "Aimbot Loaded",
    Text = "Press Q to toggle",
    Duration = 5
})
