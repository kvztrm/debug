--[[
    Aimbot Script
    - Press Q to toggle aimlock on/off
    - Automatically aims at closest player to you
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Script State
local aimlockEnabled = false
local aimlockTarget = nil
local aimSpeed = 5
local detectionRange = 100

-- Find closest player to local player
function findClosestPlayer()
    local closestPlayer = nil
    local closestDistance = detectionRange
    
    local character = LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return nil end
    
    local myRoot = character.HumanoidRootPart
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local rootPart = player.Character.HumanoidRootPart
            local distance = (rootPart.Position - myRoot.Position).Magnitude
            
            if distance < closestDistance then
                closestDistance = distance
                closestPlayer = player
            end
        end
    end
    
    return closestPlayer
end

-- Aim at target
function aimAtTarget()
    if not aimlockEnabled or not aimlockTarget or not aimlockTarget.Character then return end
    
    local targetRoot = aimlockTarget.Character:FindFirstChild("HumanoidRootPart")
    local targetHead = aimlockTarget.Character:FindFirstChild("Head")
    
    if not targetRoot and not targetHead then return end
    
    -- Aim at head if available, otherwise root
    local aimPart = targetHead or targetRoot
    if not aimPart then return end
    
    -- Calculate aim direction
    local aimCFrame = CFrame.new(Camera.CFrame.Position, aimPart.Position)
    
    -- Smooth aim with tween
    local tweenInfo = TweenInfo.new(aimSpeed, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)
    local tween = TweenService:Create(Camera, tweenInfo, {CFrame = aimCFrame})
    tween:Play()
end

-- Update loop
function updateAimbot()
    RunService.RenderStepped:Connect(function()
        if aimlockEnabled then
            -- Find closest player
            local closest = findClosestPlayer()
            
            if closest ~= aimlockTarget then
                aimlockTarget = closest
                
                if closest then
                    game.StarterGui:SetCore("SendNotification", {
                        Title = "Aimbot Target",
                        Text = closest.Name,
                        Duration = 1
                    })
                end
            end
            
            -- Keep aiming at target
            if aimlockTarget then
                aimAtTarget()
            end
        else
            aimlockTarget = nil
        end
    end)
end

-- Toggle with Q
UserInputService.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == Enum.KeyCode.Q then
            aimlockEnabled = not aimlockEnabled
            
            if aimlockEnabled then
                game.StarterGui:SetCore("SendNotification", {
                    Title = "Aimbot Enabled",
                    Text = "Press Q to disable",
                    Duration = 2
                })
                updateAimbot()
            else
                game.StarterGui:SetCore("SendNotification", {
                    Title = "Aimbot Disabled",
                    Text = "Press Q to enable",
                    Duration = 2
                })
                aimlockTarget = nil
            end
        end
    end
end)

-- Initial notification
game.StarterGui:SetCore("SendNotification", {
    Title = "Aimbot Loaded",
    Text = "Press Q to toggle",
    Duration = 5
})
