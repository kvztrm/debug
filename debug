-- AutoFish Notifier - Split long messages to avoid 400 error

-- ... (keep the rest of your script the same up to sendGrouped)

local function sendGrouped(detected)
    local now = tick()
    if now - lastSend < 30 then return end
    lastSend = now

    if #detected == 0 then return end

    local chunkSize = 15  -- max fish per message (adjust if needed)
    local chunks = {}

    for i = 1, #detected, chunkSize do
        local chunk = {}
        for j = i, math.min(i + chunkSize - 1, #detected) do
            table.insert(chunk, detected[j])
        end
        table.insert(chunks, chunk)
    end

    for chunkIdx, chunk in ipairs(chunks) do
        local lines = {}
        for i, f in ipairs(chunk) do
            table.insert(lines, i .. ". **" .. f.name .. "** - **" .. f.percent .. "%**")
        end

        local header = "**High % Fish (" .. #detected .. " total"
        if #chunks > 1 then
            header = header .. " - Part " .. chunkIdx .. "/" .. #chunks
        end
        header = header .. "):**\n"

        local message = header .. table.concat(lines, "\n")

        SendWebhook({content = message})
        task.wait(1)  -- small delay between messages to avoid rate limits
    end
end
